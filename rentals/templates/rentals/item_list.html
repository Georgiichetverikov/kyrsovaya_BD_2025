{% extends "base.html" %}
{% block title %}Каталог вещей{% endblock %}
{% block content %}
<section class="hero">
    <div class="row align-items-center">
        <div class="col-lg-7">
            <h1 class="display-6 fw-bold mb-3">Арендуйте вещи и сдавайте с комфортом</h1>
            <p class="lead text-muted">
                Транспорт, инструменты, техника, одежда — всё, что простаивает дома,
                может приносить пользу другим людям и доход вам.
            </p>
        </div>
        <div class="col-lg-5 text-lg-end mt-3 mt-lg-0">
            {% if user.is_authenticated %}
                <a href="{% url 'rentals:item_create' %}" class="btn btn-primary btn-lg">
                    + Добавить вещь
                </a>
            {% else %}
                <a href="{% url 'signup' %}" class="btn btn-warning btn-lg">
                    Начать пользоваться
                </a>
            {% endif %}
        </div>
    </div>
</section>

<!-- ——— ИСПРАВЛЕНИЕ: расширенная форма поиска ——— -->
<section class="mt-4 p-3 bg-white rounded shadow-sm">
    <form method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
            <input type="text" name="q" class="form-control" placeholder="Поиск по названию или описанию..."
                   value="{{ query|default:'' }}">
        </div>
        <div class="col-md-2">
            <select name="category" class="form-select">
                <option value="all">Все категории</option>
                {% for key, label in categories %}
                    <option value="{{ key }}" {% if selected_category == key %}selected{% endif %}>
                        {{ label }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <input type="number" name="price_min" class="form-control" placeholder="От ₽"
                   value="{{ price_min|default:'' }}" min="0">
        </div>
        <div class="col-md-2">
            <input type="number" name="price_max" class="form-control" placeholder="До ₽"
                   value="{{ price_max|default:'' }}" min="0">
        </div>
        <div class="col-md-2">
            <select name="sort" class="form-select">
                <option value="-created_at" {% if sort == '-created_at' %}selected{% endif %}>Сначала новые</option>
                <option value="daily_price" {% if sort == 'daily_price' %}selected{% endif %}>Цена ↑</option>
                <option value="-daily_price" {% if sort == '-daily_price' %}selected{% endif %}>Цена ↓</option>
            </select>
        </div>
        <div class="col-md-1">
            <button type="submit" class="btn btn-danger w-100">Найти</button>
        </div>
        {% if request.GET %}
            <div class="col-md-12 text-end">
                <a href="{% url 'rentals:item_list' %}" class="btn btn-outline-secondary btn-sm">Сбросить</a>
            </div>
        {% endif %}
    </form>
</section>

<section class="mt-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="h4 mb-0">Доступные вещи</h2>
    </div>
    <div class="row">
        {% for item in items %}
            <div class="col-md-4 col-lg-3 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title text-truncate">{{ item.title }}</h5>
                        <p class="card-text small text-muted">
                            {{ item.description|default:"Описание не указано"|truncatechars:80 }}
                        </p>
                        <p class="mt-auto mb-1">
                            <span class="fw-semibold">{{ item.daily_price }} ₽</span>
                            <span class="text-muted">/ день</span>
                        </p>
                        <a href="{% url 'rentals:item_detail' item.id %}" class="btn btn-outline-primary btn-sm mt-1">
                            Подробнее
                        </a>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>Пока нет доступных вещей. Будьте первым, кто сдаст что-то в аренду!</p>
        {% endfor %}
    </div>
</section>
{% endblock %}